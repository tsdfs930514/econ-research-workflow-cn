---
description: "在会话中创建新规则或技能（受基本准则约束）"
user_invocable: true
---

# /learn — 自扩展

在会话中创建新规则或技能。当发现某个约定、模式或工作流值得为未来会话固化时使用此技能。

## 激活

当用户运行 `/learn` 时，开始以下引导式创建流程。

---

## 步骤 1：确定类型

向用户询问：
> 你想创建什么——**规则** (rule)（编码规范/标准/约束）还是**技能** (skill)（斜杠命令工作流）？

| 类型 | 用途 | 位置 | 加载方式 |
|------|------|------|---------|
| 规则 | 标准、规范、约束 | `.claude/rules/` | 按路径匹配自动加载或始终加载 |
| 技能 | 斜杠命令工作流 | `.claude/skills/` | 用户调用时加载 (`/name`) |

---

## 步骤 2：收集内容

### 对于规则

逐一询问以下问题：

1. **名称**：这条规则叫什么？（如 `latex-conventions`）
   - 必须为小写连字符格式（kebab-case），不含空格
   - 文件为 `.claude/rules/{name}.md`

2. **作用域**：始终生效，还是仅对特定文件类型/路径生效？
   - 始终生效：不加 `paths:` 前置信息
   - 路径限定：提供 glob 模式（如 `**/*.tex`、`**/paper/**`）

3. **内容**：标准、规范或约束是什么？
   - 询问具体的"要做"和"不要做"
   - 询问正确和错误用法的示例
   - 询问是否有例外情况

### 对于技能

逐一询问以下问题：

1. **名称**：斜杠命令叫什么？（如 `clean-data`）
   - 必须为小写连字符格式（kebab-case），不含空格
   - 文件为 `.claude/skills/{name}.md`

2. **触发描述**：这个技能用一句话做什么？

3. **步骤**：梳理工作流步骤：
   - 输入是什么（用户提供什么）？
   - 应执行哪些操作？
   - 产生什么输出？
   - 有无条件逻辑或分支？

---

## 步骤 3：生成文件

### 规则模板

```markdown
---
[paths: ["glob1", "glob2"]]  # 始终生效则整行省略
---

# {标题}

{本规则约束什么的描述。}

## 标准

1. **{标准名称}**: {描述}
2. **{标准名称}**: {描述}
...

## 示例

### 正确
{示例}

### 错误
{示例}
```

### 技能模板

```markdown
---
description: "{一句话描述}"
user_invocable: true
---

# /{name} — {标题}

{一句话描述。}

## 激活

当用户运行 `/{name}` 时，执行以下操作：

## 步骤

### 1. {步骤名称}

{操作描述。}

### 2. {步骤名称}

{操作描述。}

...

## 注意事项

- {注意事项或边界情况。}
```

---

## 步骤 4：验证

写入文件之前检查：

1. **YAML 前置信息**：格式正确（技能有 `user_invocable: true`；规则有有效的 `paths:` glob 或无前置信息）
2. **无重复**：`.claude/rules/` 或 `.claude/skills/` 中不存在同名文件
3. **有效 glob 模式**：如果限定路径，glob 语法正确（`**/*.ext`、`**/dir/**`）
4. **命名规范**：小写连字符格式的文件名
5. **基本准则合规**：新规则/技能不违反 `constitution.md` 中的任何原则：
   - 不允许修改 `data/raw/`
   - 不绕过交叉验证要求（`explore/` 之外）
   - 不允许删除 `vN/` 目录
   - 不允许评分造假
   - 不损害可复现性

如果任何验证失败，说明问题并请用户修正。

---

## 步骤 5：预览与确认

展示生成的完整文件内容并询问：

```
预览 .claude/{rules|skills}/{name}.md：

---
{前置信息}
---

{内容}

---

选项：
  [yes]    — 写入此文件
  [edit]   — 让我修改（描述需要改什么）
  [cancel] — 放弃并退出
```

---

## 步骤 6：写入并记录

1. **写入文件**到相应目录。

2. **追加 `[LEARN]` 条目**到 MEMORY.md：
   ```
   - [LEARN] YYYY-MM-DD: Created {rule|skill} `{name}` — {一句话描述}
   ```

3. **确认**：
   ```
   已创建 .claude/{rules|skills}/{name}.md

   已记录到 MEMORY.md: [LEARN] {描述}

   {对于规则}: 此规则现已对 {作用域描述} 生效。
   {对于技能}: 使用 /{name} 调用此技能。
   ```

---

## 防护机制

- **不能修改 `constitution.md`**：如果用户试图创建会覆盖或削弱任何基本准则原则的规则，拒绝并说明会违反哪条原则。
- **不能覆盖已有文件**：如果同名文件已存在，请用户选择不同名称或明确确认覆盖。
- **不能创建代理**：本技能仅创建规则和技能。代理创建需要手动设置。

## 注意事项

- 保持生成文件的简洁——与仓库中已有规则/技能的风格一致。
- 用户可以在一次会话中多次运行 `/learn` 来创建多个条目。
- 创建的条目在当前会话中立即生效（规则自动加载；技能可通过 `/name` 调用）。
